# シードデータのセキュリティベストプラクティス

## 概要

開発環境でのシードデータ管理において、パスワードハッシュの取り扱いは重要なセキュリティ考慮事項です。

## 現在の実装

### 許容される理由

1. **開発環境限定**: 本番環境では使用しない
2. **既知のテストデータ**: `test123` というパスワードは一般的なテスト用パスワード
3. **ハッシュ化済み**: 平文パスワードではなくbcryptハッシュを保存
4. **開発効率**: チーム全員が同じテストデータを使える

### リスク

- 本番環境に誤って適用される可能性
- セキュリティ意識の低下につながる可能性

## 推奨される代替案

### 1. 環境変数ベース（推奨度: ⭐⭐⭐⭐⭐）

```bash
# .env.development
TEST_PASSWORD=test123

# シード実行時
TEST_PASSWORD=test123 npm run seed
```

**メリット**:

- パスワードがコードに含まれない
- 環境ごとに異なるパスワードを設定可能
- CI/CDパイプラインで管理しやすい

### 2. 動的生成（推奨度: ⭐⭐⭐⭐）

```typescript
// 実行時にハッシュを生成
const password = process.env.TEST_PASSWORD || 'test123';
const hash = await bcrypt.hash(password, 10);
```

**メリット**:

- ハッシュがコミットされない
- saltが毎回異なる

### 3. シードデータジェネレーター（推奨度: ⭐⭐⭐⭐）

`seed-data-generator.ts` を使用：

```bash
# デフォルトパスワード
TEST_PASSWORD=test123 node seed-data-generator.js

# ランダムパスワード生成
RANDOM_PASSWORD=true GENERATE_README=true node seed-data-generator.js
```

**メリット**:

- 柔軟なパスワード管理
- ドキュメント自動生成
- チーム間での共有が容易

### 4. Secrets Manager統合（推奨度: ⭐⭐⭐）

```typescript
// AWS Secrets Manager / Vault等と統合
const testPassword = await secretsManager.getSecret('dev/test-password');
```

**メリット**:

- 最高レベルのセキュリティ
- 監査ログ

**デメリット**:

- セットアップが複雑
- 開発環境には過剰

## ハッカソン向け推奨事項

### 現在の方法を継続する場合

1. **明確な警告を追加**:

```sql
-- ⚠️ 警告: 開発環境専用のテストデータです
-- 本番環境では絶対に使用しないでください
-- パスワード: test123
```

2. **ドキュメント化**:

- README.mdに明記
- セットアップガイドに記載

3. **本番デプロイ時のチェック**:

```typescript
if (process.env.NODE_ENV === 'production' && passwordHash.includes('$2b$10$dpCaTniY')) {
  throw new Error('テスト用ハッシュが検出されました！');
}
```

### 推奨実装

ハッカソンでは**現在の方法（ハッシュ直接記載）で問題ありません**。

理由：

- 参加者の技術レベルが様々
- セットアップの簡便性が重要
- 時間制約がある
- 本番運用は想定外

ただし、以下を追加：

1. **警告コメント**: シードファイルに明記
2. **ドキュメント**: TEST_ACCOUNTS.mdを作成
3. **環境チェック**: 本番環境での使用を防ぐ

## まとめ

- **開発環境**: 現在の方法で問題なし
- **ステージング**: 環境変数ベースに移行
- **本番環境**: 絶対に使用しない

セキュリティと開発効率のバランスを考慮し、プロジェクトの段階に応じて適切な方法を選択することが重要です。
