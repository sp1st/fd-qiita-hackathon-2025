# オンライン診療システム ユースケース仕様書

## ドキュメントの位置づけ

**本書は、ハッカソンに向けて開発するベースラインシステムの仕様を定義し、開発対象を明確にするものです。**

### 開発方針

- **ベースラインシステム**: ハッカソン開始時に参加者に提供する基本的なオンライン診療システム
- **手動操作前提**: 現在の医療現場の実運用に基づいた、AIに依存しない堅実な基本機能
- **拡張可能な設計**: 参加者がAI機能を追加しやすいアーキテクチャとインターフェース

### ベースラインシステムの開発範囲

本書で定義する機能は、ハッカソン主催者側で事前に開発し、参加者に提供するものです：

- ビデオ通話機能（Amazon Chime SDK使用）
- 手動での医師差配機能（差配ボード）
- 手動でのカルテ入力機能（SOAP形式）
- 基本的な予約・問診機能

### 参加者への期待

1. **基本機能の理解**: まずベースラインの仕組みを理解してください
2. **AI活用の検討**: どこにAIを適用すると価値が生まれるか考えてください
3. **独自の実装**: 音声認識、自然言語処理、画像解析など、自由な発想で機能を拡張してください

## 概要

本書は、ハッカソン向けオンライン診療システムのユースケースを定義します。実際のファストドクターの事業課題を踏まえ、AI技術を活用した次世代オンライン診療の実現を目指します。

## システムスコープ

```mermaid
graph LR
    A[予約] --> B[事前問診]
    B --> C[医師差配]
    C --> D[診察実施]
    D --> E[カルテ記入]
    E --> F[処方]
    F --> G[レセプト]

    classDef highlight stroke-width:4px,font-weight:bold
    class B,C,D,E,G highlight
```

**重点実装領域**: 事前問診、診察実施、カルテ記入（AI活用の可能性が高い領域）

## ステークホルダー定義

### 1. 患者（Patient）

- オンライン診療を利用する一般ユーザー
- 年齢層: 20-60代（スマートフォン操作に慣れている層）
- 技術リテラシー: 中程度

### 2. 医師（Doctor）

- オンライン診療を提供する医療従事者
- 診療科: 内科、呼吸器科、皮膚科、メンタルヘルス科等
- 技術リテラシー: 中〜高程度

### 3. ハッカソン参加者（Developer）

- システムを拡張・カスタマイズする開発者
- 高校生〜大学院生
- 技術リテラシー: 高程度

## ユースケース一覧

### AI活用度の凡例

- **△**: ベースラインは手動実装、AI活用の余地は少ない
- **○**: ベースラインは手動実装、AI支援機能の追加で価値向上が期待できる
- **◎**: ベースラインでも一部AI機能を含む、さらなるAI活用で大幅な価値向上が可能

| UC ID | ユースケース名           | 主アクター | 優先度 | AI活用 |
| ----- | ------------------------ | ---------- | ------ | ------ |
| UC-01 | 診療を予約する           | 患者       | 高     | ◯      |
| UC-02 | AI支援事前問診を実施する | 患者       | 高     | ◎      |
| UC-03 | 医師を差配する           | オペレータ | 高     | ○      |
| UC-04 | ビデオ診察を実施する     | 医師・患者 | 高     | ◎      |
| UC-05 | 診察内容を記録する       | 医師       | 高     | ○      |
| UC-06 | 処方箋を発行する         | 医師       | 中     | △      |
| UC-07 | 音声ストリームを解析する | システム   | 高     | ◎      |
| UC-08 | 診察サマリーを生成する   | システム   | 高     | ◎      |

## 詳細ユースケース

### UC-01: 診療予約を作成する

**概要**: 患者が診療予約を作成し、基本情報を登録する

**事前条件**:

- 患者がシステムにアクセス可能である

**基本フロー**:

1. 患者が予約画面にアクセスする
2. 患者が希望日時を選択する
3. 患者が基本情報（氏名、年齢、性別）を入力する
4. 患者が主訴（主な症状）を簡単に入力する
5. システムが予約を確定し、予約IDを発行する
6. 患者に予約確認画面を表示する

**代替フロー**:

- 3a. 既存患者の場合、過去の情報を自動入力

**事後条件**:

- 予約情報がデータベースに保存される
- 患者に予約確認メールが送信される

### UC-02: AI支援事前問診を実施する

**概要**: AIが患者の症状に応じて動的に問診を実施する

**事前条件**:

- 予約が作成されている
- 患者が問診開始可能な状態である

**基本フロー**:

1. 患者が問診開始ボタンを押す
2. システムが初期質問を表示する（主訴に基づく）
3. 患者が音声またはテキストで回答する
4. AIが回答を解析し、症状カテゴリを判定する
5. AIが追加質問を動的に生成する
6. 患者が追加質問に回答する（3-6を繰り返す）
7. AIが問診サマリーを生成する
8. 患者が問診内容を確認・承認する

**AI機能詳細**:

```
- 音声認識: 患者の音声入力をテキスト化
- 自然言語処理: 症状キーワード抽出、緊急度判定
- 動的質問生成: 症状に応じた追加質問の自動生成
- 感情分析: 患者の不安度・緊急度の推定
```

**代替フロー**:

- 4a. 緊急症状を検出した場合、緊急対応フローへ移行

**事後条件**:

- 問診結果が構造化データとして保存される
- 医師差配用のデータが準備される

### UC-03: 医師を差配する

**概要**: オペレータが問診結果を基に最適な医師を選定・割り当てる

**事前条件**:

- 問診が完了している
- 対応可能な医師が存在する

**基本フロー**:

1. オペレータが差配ボードにアクセスする
2. オペレータが待機患者の問診結果を確認する
3. オペレータが必要な診療科を判断する
4. オペレータが対応可能な医師リストを確認する
5. オペレータが症状と医師の専門性を考慮して医師を選定する
6. オペレータが医師に患者を割り当てる（ドラッグ&ドロップ）
7. システムが医師に診察依頼を送信する
8. 医師が診察を承諾する

**AI支援機能（オペレータ支援）**:

```
- 症状分類支援: 問診結果から推奨診療科を提示
- 医師マッチング提案: 専門性、対応可能時間、過去実績を基に推奨医師を提示
- 負荷状況可視化: 医師の稼働状況をリアルタイム表示
- 優先度提案: 緊急度・待ち時間を考慮した患者優先順位の提示
```

**事後条件**:

- 医師が診察に割り当てられる
- 患者に医師情報が通知される

### UC-04: ビデオ診察を実施する

**概要**: 医師と患者がビデオ通話で診察を行う

**事前条件**:

- 医師が割り当てられている
- 両者がビデオ通話可能な環境にある

**基本フロー**:

1. 医師が診察開始ボタンを押す
2. 患者に通話開始通知が送信される
3. 患者が通話に参加する
4. システムが音声・ビデオストリームを開始する
5. 医師が問診内容を確認しながら診察する
6. システムが会話内容をリアルタイムで文字起こしする
7. 医師が診察を終了する
8. システムが診察記録を保存する

**AI機能詳細**:

```
- リアルタイム文字起こし: 会話内容の自動記録
- 医療用語抽出: 重要な医療情報のハイライト
- 非言語情報分析: 患者の表情・声調から状態推定
```

**技術要件**:

- Amazon Chime SDK for ビデオ通話
- WebSocket for リアルタイムストリーミング
- Cloudflare AI / OpenAI Whisper for 音声認識

**事後条件**:

- 診察内容が記録される
- カルテ作成用データが準備される

### UC-05: 診察内容を記録する

**概要**: 医師が診察内容をSOAP形式でカルテに記録する

**事前条件**:

- 診察が実施中または完了している
- 医師がカルテ入力画面にアクセス可能である

**基本フロー**:

1. 医師が診察を実施する
2. 医師がカルテ入力画面を開く
3. 医師が主観的所見（S）を入力する（患者の主訴・症状）
4. 医師が客観的所見（O）を入力する（診察所見・検査結果）
5. 医師が評価（A）を入力する（診断・病名）
6. 医師が計画（P）を入力する（治療方針・処方内容）
7. 医師がカルテ内容を確認する
8. 医師がカルテを保存・確定する

**SOAP形式**:

- S (Subjective): 患者の主訴・自覚症状
- O (Objective): 医師の観察所見
- A (Assessment): 診断・評価
- P (Plan): 治療計画・処方

**AI支援機能（将来的な拡張）**:

```
- 音声入力支援: 医師の音声をテキストに変換（将来実装）
- 医療用語サジェスト: 入力中の医療用語候補を提示
- テンプレート提供: 診療科別のカルテテンプレート
- 処方支援: 診断に基づく標準的な処方の提案（将来実装）
```

**事後条件**:

- 構造化されたカルテが保存される
- 処方判断用のデータが準備される

### UC-06: 処方箋を発行する

**概要**: 医師が診断に基づいて処方箋を発行する

**事前条件**:

- 診察が完了している
- カルテが作成されている

**基本フロー**:

1. 医師が処方画面を開く
2. システムが診療科別の薬剤リストを表示する
3. AIが症状に基づく推奨薬剤を提示する
4. 医師が処方薬を選択する
5. システムが禁忌・相互作用をチェックする
6. 医師が用法・用量を指定する
7. 医師が処方箋を確定する
8. システムが電子処方箋を生成する

**AI機能詳細**:

```
- 処方推奨: 症状・診断に基づく薬剤提案
- 安全性チェック: 禁忌・相互作用の自動確認
- 用量計算: 患者属性に基づく適正用量提案
```

**事後条件**:

- 処方箋が発行される
- 薬局連携データが生成される

### UC-07: 音声ストリームを解析する

**概要**: システムが診察中の音声をリアルタイムで解析する

**事前条件**:

- ビデオ診察が実施中である
- 音声ストリームが取得可能である

**基本フロー**:

1. システムが音声ストリームを取得する
2. システムが音声データをチャンク分割する
3. AIが各チャンクを文字起こしする
4. AIが医療用語を抽出・分類する
5. AIが感情・緊急度を分析する
6. システムが解析結果を医師画面に表示する
7. システムが重要情報をハイライトする

**技術実装**:

```typescript
// 音声ストリーム処理の例
const processAudioStream = async (audioChunk: ArrayBuffer) => {
  // Cloudflare AI / OpenAI Whisper
  const transcript = await AI.transcribe(audioChunk);

  // 医療エンティティ抽出
  const entities = await AI.extractMedicalEntities(transcript);

  // リアルタイム表示
  updateDoctorView(transcript, entities);
};
```

**事後条件**:

- 文字起こしデータが保存される
- 医療情報が構造化される

### UC-08: 診察サマリーを生成する

**概要**: AIが診察終了後に患者向けサマリーを自動生成する

**事前条件**:

- 診察が完了している
- カルテが作成されている

**基本フロー**:

1. システムが診察データを収集する
2. AIが重要ポイントを抽出する
3. AIが患者向けに平易な言葉で要約する
4. AIが次回受診の目安を提案する
5. 医師がサマリーを確認・承認する
6. システムが患者にサマリーを送信する

**AI生成内容**:

- 診断結果の説明（専門用語を避ける）
- 処方薬の服用方法
- 生活上の注意点
- 次回受診の目安
- 緊急時の対応方法

**事後条件**:

- 診察サマリーが患者に送信される
- フォローアップ予定が設定される

## 非機能要件

### セキュリティ要件

- 医療情報の暗号化（保存時・通信時）
- 患者プライバシーの保護
- アクセス制御（医師・患者の適切な権限管理）

### パフォーマンス要件

- ビデオ通話: 遅延 < 200ms
- 音声認識: リアルタイム処理（遅延 < 1秒）
- AI応答: 95%の処理を3秒以内

### 可用性要件

- システム稼働率: 99.5%以上
- 診察時間帯（8:00-22:00）の安定稼働

### 拡張性要件

- ハッカソン参加者が容易に機能追加可能
- プラグイン形式でのAI機能拡張
- 多言語対応の考慮

## ベースラインシステムの実装優先順位

以下は、ハッカソン開始前に我々が開発する機能の優先順位です。

### Phase 1: MVP（ハッカソン前に必須実装）

1. UC-04: ビデオ診察を実施する（基本機能）
2. UC-07: 音声ストリームを解析する（基本的な音声取得のみ）
3. UC-05: 診察内容を記録する（手動入力）
4. UC-03: 医師を差配する（手動差配ボード）

### Phase 2: 基本機能の追加（ハッカソン前に推奨実装）

5. UC-01: 診療予約を作成する（基本的な予約機能）
6. UC-02: AI支援事前問診を実施する（基本的な問診フォーム）
7. UC-06: 処方箋を発行する（手動入力）

### Phase 3: ハッカソン参加者による拡張想定

以下は参加者がAIを活用して拡張することを期待する機能：

- UC-02の高度化: AIによる動的問診、音声入力対応
- UC-05の自動化: 音声認識による自動カルテ生成
- UC-03の自動化: AIによる医師の自動マッチング
- UC-08の実装: AI診察サマリーの自動生成

## 開発者向けガイドライン

### ベースライン技術スタック（開発予定）

- **フロントエンド**: React + TypeScript + shadcn/ui
- **バックエンド**: Hono (Cloudflare Workers) / FastAPI (Python)
- **リアルタイム通信**: WebSocket
- **ビデオ通話**: Amazon Chime SDK
- **データベース**: SQLite (開発) / Cloudflare D1 (本番) + Drizzle ORM
- **認証**: JWT ベースの認証システム

### AI技術の活用例（参加者が自由に選択・実装）

- **音声認識**: OpenAI Whisper, Google Speech-to-Text, AWS Transcribe
- **自然言語処理**: GPT-4, Claude, Gemini, BERT
- **画像解析**: Vision API, Custom ML Models
- **感情分析**: Amazon Comprehend, Azure Text Analytics

### 拡張ポイント

1. **音声の活用**
   - リアルタイム文字起こし機能の追加
   - 音声コマンドによる操作
   - 診察内容の自動要約

2. **画像・映像の活用**
   - 患者の表情から健康状態を推定
   - 皮膚症状の画像診断支援
   - ジェスチャー認識による操作

3. **自然言語処理の活用**
   - 問診の自動化・効率化
   - 医療用語の自動抽出
   - 多言語対応

4. **データ分析・予測**
   - 症状から疾患の可能性を提示
   - 最適な医師のマッチング
   - 待ち時間の予測

### ベースラインコードの構造

```
src/
├── frontend/          # React アプリケーション
│   ├── components/    # 再利用可能なUIコンポーネント
│   ├── pages/        # 各画面のコンポーネント
│   └── hooks/        # カスタムフック（AI機能追加に活用）
├── backend/          # API サーバー
│   ├── routes/       # APIエンドポイント
│   ├── services/     # ビジネスロジック（AI連携はここに）
│   └── websocket/    # リアルタイム通信
└── shared/           # 共通の型定義・ユーティリティ
```

## まとめ

本ユースケース仕様書は、ハッカソンに向けて開発するベースラインシステムの仕様を定義しています。

### ベースラインシステムの開発目標

- **実用的な基本機能**: 実際の医療現場で使用されている手動操作を前提とした堅実な実装
- **明確な開発範囲**: 各ユースケースの基本フローに沿った最小限の機能セット
- **拡張性の確保**: ハッカソン参加者がAI機能を追加しやすいアーキテクチャ設計

### ハッカソン参加者へのメッセージ

私たちが開発・提供するベースラインシステムは「完成品」ではなく「出発点」です。皆さんの創意工夫により、以下のような革新的な機能を追加してください：

- 音声認識による診察記録の自動化
- AIによる問診の効率化
- 画像解析を活用した診断支援
- 多言語対応による国際的な医療サービス
- その他、医療現場の課題を解決する独創的なアイデア

医師の業務効率化と患者体験の向上を同時に実現する、次世代のオンライン診療システムを一緒に創りましょう！
